<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>DJ Roster ‚Äî Ark Bar & Love Beach Club</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

:root {
  /* Ark Bar website palette */
  --teal:        #5DB8C0;
  --teal-dark:   #3a9aa3;
  --teal-light:  #A8D8DC;
  --teal-pale:   #dff1f3;
  --teal-bg:     #eaf6f7;
  --ark-blue:    #2B3990;
  --ark-orange:  #F15A29;
  --white:       #ffffff;
  --text-dark:   #1c2b2d;
  --text-mid:    #4a6e72;
  --text-light:  #89b5b9;
  --border:      #c6e4e7;
  --border-soft: #daeef0;
  --radius:      16px;
  --radius-sm:   10px;
  --shadow:      0 4px 24px rgba(45,130,140,0.12);
  --shadow-sm:   0 2px 12px rgba(45,130,140,0.08);
}

html { scroll-behavior: smooth; }

body {
  font-family: 'Montserrat', sans-serif;
  background: #0b1020;
  color: var(--text-dark);
  min-height: 100vh;
  padding-bottom: 60px;
}

/* ‚îÄ‚îÄ BACKGROUND ORBS ‚îÄ‚îÄ */
.bg-fixed { position: fixed; inset: 0; z-index: 0; pointer-events: none; }
.bg-orb { position: absolute; border-radius: 50%; filter: blur(100px); animation: drift 14s ease-in-out infinite alternate; }
.bg-orb:nth-child(1) { width: 700px; height: 700px; background: radial-gradient(circle, #2B3990 0%, transparent 70%); top: -200px; left: -200px; opacity: 0.5; animation-delay: 0s; }
.bg-orb:nth-child(2) { width: 500px; height: 500px; background: radial-gradient(circle, #5DB8C0 0%, transparent 70%); bottom: -150px; right: -100px; opacity: 0.3; animation-delay: -5s; }
.bg-orb:nth-child(3) { width: 350px; height: 350px; background: radial-gradient(circle, #F15A29 0%, transparent 70%); top: 40%; left: 55%; opacity: 0.12; animation-delay: -9s; }
@keyframes drift { from { transform: translate(0,0); } to { transform: translate(40px,-50px); } }

/* All content above the orbs */
.header, .wrap { position: relative; z-index: 1; }

.back-btn {
  display: inline-flex; align-items: center; gap: 6px;
  margin-bottom: 16px;
  padding: 6px 14px; border-radius: 20px;
  font-size: 11px; font-weight: 700; letter-spacing: 0.05em;
  color: rgba(255,255,255,0.5);
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.12);
  text-decoration: none;
  transition: all 0.2s;
}
.back-btn:hover { color: white; background: rgba(255,255,255,0.14); border-color: rgba(255,255,255,0.25); }

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.header {
  background: rgba(255,255,255,0.06);
  backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
  border-bottom: 1px solid rgba(255,255,255,0.1);
  padding: 28px 20px 36px;
  text-align: center;
}

.header-logos {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;
  margin-bottom: 14px;
}

.logo-ark {
  height: 52px;
  width: auto;
  object-fit: contain;
}

.logo-love {
  height: 40px;
  width: auto;
  object-fit: contain;
  opacity: 0.9;
}

.logo-divider {
  width: 1px;
  height: 36px;
  background: rgba(255,255,255,0.25);
}

.header-eyebrow {
  font-size: 10px; font-weight: 700; letter-spacing: 0.25em;
  text-transform: uppercase; color: rgba(255,255,255,0.5); margin-bottom: 10px;
}
.header-title {
  font-size: clamp(28px, 7vw, 40px); font-weight: 900;
  color: white; letter-spacing: -0.02em; line-height: 1.05;
}
.header-sub {
  font-size: 12px; font-weight: 600; color: rgba(255,255,255,0.4);
  letter-spacing: 0.12em; text-transform: uppercase; margin-top: 8px;
}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.wrap { max-width: 480px; margin: 0 auto; padding: 0 16px; }

/* ‚îÄ‚îÄ STEPS ‚îÄ‚îÄ */
.steps-wrap { padding: 20px 4px 4px; }
.steps-row { display: flex; align-items: center; }
.step-dot {
  width: 32px; height: 32px; border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.15);
  background: rgba(255,255,255,0.06);
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 800; color: rgba(255,255,255,0.3);
  flex-shrink: 0; transition: all 0.3s; font-family: 'Montserrat', sans-serif;
}
.step-dot.active { background: var(--teal); border-color: var(--teal); color: white; box-shadow: 0 0 0 5px rgba(93,184,192,0.2); }
.step-dot.done { background: rgba(93,184,192,0.3); border-color: var(--teal); color: white; }
.step-line { flex: 1; height: 2px; background: rgba(255,255,255,0.08); transition: background 0.3s; }
.step-line.done { background: var(--teal); }
.step-labels { display: flex; justify-content: space-between; margin-top: 6px; }
.step-lbl { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.12em; color: rgba(255,255,255,0.25); width: 32px; text-align: center; }
.step-lbl.active { color: var(--teal); }
.step-lbl.done { color: var(--teal); }

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card {
  background: rgba(255,255,255,0.07);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: var(--radius);
  padding: 24px;
  margin-top: 14px;
  display: none;
  animation: up 0.3s ease;
}
.card.active { display: block; }
@keyframes up {
  from { opacity: 0; transform: translateY(14px); }
  to   { opacity: 1; transform: translateY(0); }
}

.card-title {
  font-size: 18px; font-weight: 800; color: white;
  margin-bottom: 5px; letter-spacing: -0.01em;
}
.card-sub {
  font-size: 12px; font-weight: 500; color: rgba(255,255,255,0.5);
  line-height: 1.6; margin-bottom: 22px;
}

/* ‚îÄ‚îÄ FIELD LABEL ‚îÄ‚îÄ */
.field { margin-bottom: 16px; }
.field-label {
  display: block; font-size: 10px; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.12em;
  color: rgba(255,255,255,0.4); margin-bottom: 8px;
}

/* ‚îÄ‚îÄ CUSTOM SELECT ‚îÄ‚îÄ */
.custom-select { position: relative; }

.custom-select-trigger {
  width: 100%; padding: 14px 44px 14px 16px;
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: var(--radius-sm);
  font-family: 'Montserrat', sans-serif; font-size: 14px; font-weight: 600;
  color: white; background: rgba(255,255,255,0.08);
  cursor: pointer; display: flex; align-items: center; justify-content: space-between;
  transition: border-color 0.2s, background 0.2s; user-select: none; position: relative;
}
.custom-select-trigger .placeholder { color: rgba(255,255,255,0.3); font-weight: 500; }
.custom-select-trigger .selected-val { color: white; font-weight: 700; }
.custom-select-trigger .arrow {
  position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
  width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;
  transition: transform 0.25s; color: rgba(255,255,255,0.3);
}
.custom-select.open .custom-select-trigger { border-color: var(--teal); background: rgba(93,184,192,0.1); }
.custom-select.open .arrow { transform: translateY(-50%) rotate(180deg); }

.custom-select-dropdown {
  position: absolute; top: calc(100% + 6px); left: 0; right: 0;
  background: rgba(20,28,55,0.97);
  backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
  border: 1px solid rgba(93,184,192,0.4);
  border-radius: var(--radius-sm);
  box-shadow: 0 12px 40px rgba(0,0,0,0.5); z-index: 100; overflow: hidden;
  max-height: 0; opacity: 0; transition: max-height 0.3s ease, opacity 0.25s ease; pointer-events: none;
}
.custom-select.open .custom-select-dropdown { max-height: 320px; opacity: 1; pointer-events: all; overflow-y: auto; }
.custom-select-dropdown::-webkit-scrollbar { width: 4px; }
.custom-select-dropdown::-webkit-scrollbar-track { background: transparent; }
.custom-select-dropdown::-webkit-scrollbar-thumb { background: rgba(93,184,192,0.3); border-radius: 4px; }

.custom-option {
  padding: 12px 16px; font-size: 14px; font-weight: 600; color: rgba(255,255,255,0.8);
  cursor: pointer; transition: background 0.15s; font-family: 'Montserrat', sans-serif;
}
.custom-option:hover { background: rgba(93,184,192,0.15); color: white; }
.custom-option.selected { background: rgba(93,184,192,0.2); color: var(--teal); font-weight: 700; }
.custom-option + .custom-option { border-top: 1px solid rgba(255,255,255,0.06); }

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn {
  display: flex; align-items: center; justify-content: center; gap: 8px;
  width: 100%; padding: 15px;
  border-radius: var(--radius-sm);
  font-family: 'Montserrat', sans-serif; font-size: 14px; font-weight: 700;
  cursor: pointer; transition: all 0.2s; letter-spacing: 0.02em; border: 1px solid transparent;
}
.btn-primary {
  background: rgba(93,184,192,0.2); color: white;
  border-color: rgba(93,184,192,0.5);
  backdrop-filter: blur(10px);
}
.btn-primary:hover { background: rgba(93,184,192,0.35); border-color: var(--teal); transform: translateY(-1px); }
.btn-primary:active { transform: translateY(0); }
.btn-primary:disabled { opacity: 0.35; cursor: not-allowed; transform: none; }

.btn-ghost {
  background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.5);
  border-color: rgba(255,255,255,0.12);
}
.btn-ghost:hover { border-color: rgba(255,255,255,0.3); color: white; background: rgba(255,255,255,0.1); }

.btn-submit {
  background: rgba(241,90,41,0.25); color: white;
  border-color: rgba(241,90,41,0.5);
  backdrop-filter: blur(10px);
}
.btn-submit:hover { background: rgba(241,90,41,0.45); border-color: var(--ark-orange); transform: translateY(-1px); }
.btn-submit:disabled { opacity: 0.35; cursor: not-allowed; transform: none; }

.btn-row { display: flex; gap: 10px; margin-top: 20px; }
.btn-row .btn-ghost { flex: 1; }
.btn-row .btn-primary, .btn-row .btn-submit { flex: 2; }

.day-card {
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: var(--radius-sm); margin-bottom: 8px; overflow: hidden;
  transition: border-color 0.2s;
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
}
.day-card.has-slots { border-color: rgba(93,184,192,0.5); }

.day-header {
  display: flex; align-items: center; padding: 12px 14px; cursor: pointer;
  user-select: none; gap: 10px; transition: background 0.15s;
}
.day-header:active { background: rgba(255,255,255,0.05); }

.day-dow { font-size: 12px; font-weight: 800; color: var(--teal); min-width: 34px; text-transform: uppercase; letter-spacing: 0.05em; }
.day-date-txt { font-size: 13px; font-weight: 600; color: rgba(255,255,255,0.6); flex: 1; }
.day-badge { background: var(--teal); color: white; font-size: 10px; font-weight: 700; padding: 3px 9px; border-radius: 20px; display: none; font-family: 'Montserrat', sans-serif; }
.day-card.has-slots .day-badge { display: block; }
.day-chevron { color: rgba(255,255,255,0.25); font-size: 12px; transition: transform 0.25s; flex-shrink: 0; }
.day-card.open .day-chevron { transform: rotate(180deg); }

.time-picker {
  display: none; padding: 14px;
  border-top: 1px solid rgba(255,255,255,0.08);
  background: rgba(0,0,0,0.2);
}
.day-card.open .time-picker { display: block; }

.range-block {
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 10px; padding: 12px; margin-bottom: 10px; position: relative;
}
.range-row { display: flex; align-items: center; gap: 8px; }
.range-lbl { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: rgba(255,255,255,0.3); white-space: nowrap; min-width: 28px; }

/* ‚îÄ‚îÄ INLINE TIME SELECTS ‚îÄ‚îÄ */
.time-sel {
  flex: 1; padding: 10px 8px;
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 8px; font-family: 'Montserrat', sans-serif;
  font-size: 13px; font-weight: 700; color: white;
  background: rgba(255,255,255,0.08);
  outline: none; appearance: none; -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='rgba(255,255,255,0.3)' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 8px center;
  cursor: pointer; min-width: 0; transition: border-color 0.2s;
}
.time-sel:focus { border-color: var(--teal); background: rgba(93,184,192,0.1); }
.time-sel option { background: #1a2255; color: white; }

.range-arrow { color: rgba(255,255,255,0.2); font-size: 14px; flex-shrink: 0; }

.remove-btn {
  position: absolute; top: 8px; right: 8px;
  background: none; border: none; color: rgba(255,255,255,0.25);
  font-size: 14px; cursor: pointer; padding: 3px 6px;
  border-radius: 4px; transition: all 0.15s;
}
.remove-btn:hover { background: rgba(241,90,41,0.2); color: #ff8a65; }

.slots-preview { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 10px; min-height: 4px; }
.slot-chip {
  background: rgba(93,184,192,0.2); color: var(--teal);
  border: 1px solid rgba(93,184,192,0.3);
  font-size: 10px; font-weight: 700; padding: 3px 9px; border-radius: 20px;
  font-family: 'Montserrat', sans-serif; animation: pop 0.18s ease;
}
@keyframes pop { from { transform: scale(0.75); opacity: 0; } to { transform: scale(1); opacity: 1; } }

.add-range-btn {
  display: flex; align-items: center; justify-content: center; gap: 6px;
  width: 100%; background: none;
  border: 1px dashed rgba(255,255,255,0.15);
  border-radius: 8px; color: rgba(255,255,255,0.3);
  font-family: 'Montserrat', sans-serif; font-size: 11px; font-weight: 700;
  padding: 9px; cursor: pointer; transition: all 0.2s; margin-top: 4px;
}
.add-range-btn:hover { border-color: var(--teal); color: var(--teal); background: rgba(93,184,192,0.08); }

.day-note { font-size: 10px; color: rgba(255,255,255,0.25); text-align: center; margin-top: 10px; font-weight: 500; font-style: italic; }

/* ‚îÄ‚îÄ BLACKOUT CALENDAR (residents) ‚îÄ‚îÄ */
function buildBlackoutCal() {
  const el = document.getElementById('blackout-cal');
  el.innerHTML = '';
  const [y, m] = moKey.split('-').map(Number);
  const mo = m - 1;
  const days = new Date(y, mo + 1, 0).getDate();
  const DAYS_SHORT = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  for (let d = 1; d <= days; d++) {
    const date = new Date(y, mo, d);
    const dow = date.getDay();
    const key = `${y}-${String(mo+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const dateLabel = `${d} ${MN[mo]} ${y}`;
    const isOff = blackoutDates.has(dateLabel);
    const card = document.createElement('div');
    card.id = 'bc-' + key;
    card.style.cssText = `
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 16px; margin-bottom:8px; border-radius:12px; cursor:pointer;
      border:1px solid ${isOff ? 'rgba(241,90,41,0.5)' : 'rgba(255,255,255,0.08)'};
      background:${isOff ? 'rgba(241,90,41,0.15)' : 'rgba(255,255,255,0.04)'};
      transition:all 0.15s;
    `;
    card.innerHTML = `
      <div style="display:flex;align-items:center;gap:12px;">
        <div style="font-size:10px;font-weight:800;color:${dow===0||dow===6?'var(--ark-orange)':'var(--teal)'};text-transform:uppercase;letter-spacing:0.08em;min-width:28px;">${DAYS_SHORT[dow]}</div>
        <div style="font-size:14px;font-weight:700;color:${isOff?'rgba(255,255,255,0.9)':'rgba(255,255,255,0.6)'};">${d} ${MN[mo]}</div>
      </div>
      <div style="font-size:11px;font-weight:800;color:${isOff?'#ff8a65':'rgba(255,255,255,0.2)'};">
        ${isOff ? '‚úï NOT AVAILABLE' : 'Available'}
      </div>`;
    card.onclick = () => toggleBlackout(key, dateLabel, mo, y);
    el.appendChild(card);
  }
}

function toggleBlackout(key, dateLabel, mo, y) {
  if (blackoutDates.has(dateLabel)) {
    blackoutDates.delete(dateLabel);
  } else {
    blackoutDates.add(dateLabel);
  }
  // Re-render just this card
  const d = parseInt(key.split('-')[2]);
  const date = new Date(+key.split('-')[0], mo, d);
  const dow = date.getDay();
  const DAYS_SHORT = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  const isOff = blackoutDates.has(dateLabel);
  const card = document.getElementById('bc-' + key);
  if (card) {
    card.style.borderColor = isOff ? 'rgba(241,90,41,0.5)' : 'rgba(255,255,255,0.08)';
    card.style.background = isOff ? 'rgba(241,90,41,0.15)' : 'rgba(255,255,255,0.04)';
    card.innerHTML = `
      <div style="display:flex;align-items:center;gap:12px;">
        <div style="font-size:10px;font-weight:800;color:${dow===0||dow===6?'var(--ark-orange)':'var(--teal)'};text-transform:uppercase;letter-spacing:0.08em;min-width:28px;">${DAYS_SHORT[dow]}</div>
        <div style="font-size:14px;font-weight:700;color:${isOff?'rgba(255,255,255,0.9)':'rgba(255,255,255,0.6)'};">${d} ${MN[mo]}</div>
      </div>
      <div style="font-size:11px;font-weight:800;color:${isOff?'#ff8a65':'rgba(255,255,255,0.2)'};">
        ${isOff ? '‚úï NOT AVAILABLE' : 'Available'}
      </div>`;
    card.onclick = () => toggleBlackout(key, dateLabel, mo, parseInt(key.split('-')[0]));
  }
}

/* ‚îÄ‚îÄ CALENDAR ‚îÄ‚îÄ */
.cal-month-title {
  font-size: 16px; font-weight: 800; color: white;
  margin-bottom: 14px; display: flex; align-items: center; gap: 10px; letter-spacing: -0.01em;
}
.cal-month-title::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, rgba(93,184,192,0.4), transparent); border-radius: 2px; }

/* ‚îÄ‚îÄ SUMMARY ‚îÄ‚îÄ */
.summary-header {
  background: rgba(93,184,192,0.15);
  border: 1px solid rgba(93,184,192,0.3);
  border-radius: var(--radius-sm); padding: 16px 18px; color: white;
  margin-bottom: 14px; display: flex; justify-content: space-between; align-items: center;
  backdrop-filter: blur(12px);
}
.s-dj { font-size: 18px; font-weight: 800; letter-spacing: -0.01em; }
.s-month { font-size: 11px; font-weight: 500; opacity: 0.6; margin-top: 2px; }
.s-hours {
  background: rgba(241,90,41,0.25); border: 1px solid rgba(241,90,41,0.4);
  color: white; border-radius: 10px; padding: 8px 14px; text-align: center; flex-shrink: 0;
}
.s-hours .num { display: block; font-size: 24px; font-weight: 900; line-height: 1; }
.s-hours .lbl { font-size: 9px; font-weight: 700; opacity: 0.8; text-transform: uppercase; letter-spacing: 0.1em; }

.summary-row {
  display: flex; align-items: flex-start; gap: 12px;
  padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.06);
}
.summary-row:last-child { border-bottom: none; }
.s-date { min-width: 66px; }
.s-dow { font-size: 11px; font-weight: 800; color: var(--teal); text-transform: uppercase; letter-spacing: 0.06em; }
.s-num { font-size: 11px; color: rgba(255,255,255,0.3); font-weight: 500; }
.s-chips { display: flex; flex-wrap: wrap; gap: 4px; flex: 1; }
.s-chip { background: rgba(93,184,192,0.15); color: var(--teal); font-size: 10px; font-weight: 700; padding: 3px 8px; border-radius: 20px; border: 1px solid rgba(93,184,192,0.3); }

/* ‚îÄ‚îÄ SUCCESS ‚îÄ‚îÄ */
.success {
  display: none; text-align: center; padding: 48px 24px;
  background: rgba(255,255,255,0.07);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: var(--radius); margin-top: 14px; animation: up 0.4s ease;
}
.success.show { display: block; }
.success .icon { font-size: 56px; margin-bottom: 16px; }
.success h2 { font-size: 24px; font-weight: 800; color: white; margin-bottom: 8px; letter-spacing: -0.01em; }
.success p { font-size: 13px; font-weight: 500; color: rgba(255,255,255,0.5); line-height: 1.65; margin-bottom: 24px; }
.success .reset-btn {
  display: inline-flex; align-items: center; gap: 8px; padding: 13px 26px;
  background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15);
  border-radius: var(--radius-sm); font-family: 'Montserrat', sans-serif;
  font-size: 13px; font-weight: 700; color: rgba(255,255,255,0.6); cursor: pointer; transition: all 0.2s;
}
.success .reset-btn:hover { border-color: var(--teal); color: white; }

/* ‚îÄ‚îÄ ALL MONTH BUTTON ‚îÄ‚îÄ */
.btn-all-month {
  display: flex; align-items: center; gap: 14px; width: 100%; padding: 14px 18px;
  background: rgba(93,184,192,0.15); border: 1px solid rgba(93,184,192,0.35);
  border-radius: var(--radius-sm); color: white; cursor: pointer; text-align: left;
  transition: all 0.2s; font-family: 'Montserrat', sans-serif;
  backdrop-filter: blur(10px);
}
.btn-all-month:hover { background: rgba(93,184,192,0.25); border-color: var(--teal); transform: translateY(-1px); }
.btn-all-month.active {
  background: rgba(241,90,41,0.2); border-color: rgba(241,90,41,0.4);
}
.btn-all-month.active::after { content: '‚úì All month selected ‚Äî tap to clear'; font-size: 10px; font-weight: 700; opacity: 0.8; }

/* ‚îÄ‚îÄ FULL DAY BUTTON ‚îÄ‚îÄ */
.full-day-btn {
  display: flex; align-items: center; justify-content: center; gap: 6px;
  padding: 7px 12px; background: rgba(93,184,192,0.1);
  border: 1px solid rgba(93,184,192,0.25); border-radius: 20px;
  font-family: 'Montserrat', sans-serif; font-size: 10px; font-weight: 700;
  color: var(--teal); cursor: pointer; transition: all 0.2s; white-space: nowrap;
}
.full-day-btn:hover { background: rgba(93,184,192,0.25); border-color: var(--teal); color: white; }
.full-day-btn.active { background: var(--teal); color: white; border-color: var(--teal); }

/* ‚îÄ‚îÄ DIVIDER ‚îÄ‚îÄ */
.section-divider { height: 1px; background: rgba(255,255,255,0.06); margin: 4px 0 16px; }
</style>
</head>
<body>

<div class="bg-fixed">
  <div class="bg-orb"></div>
  <div class="bg-orb"></div>
  <div class="bg-orb"></div>
</div>

<!-- HEADER -->
<div class="header">
  <a href="/" class="back-btn">‚Üê Portal</a>
  <div class="header-eyebrow">ARKbar Beach Club &amp; Love Beach Club</div>
  <div class="header-title">DJ Roster</div>
  <div class="header-sub">Availability Submission</div>
</div>

<div class="wrap">

  <!-- STEPS -->
  <div class="steps-wrap">
    <div class="steps-row">
      <div class="step-dot active" id="dot1">1</div>
      <div class="step-line" id="line1"></div>
      <div class="step-dot" id="dot2">2</div>
      <div class="step-line" id="line2"></div>
      <div class="step-dot" id="dot3">3</div>
    </div>
    <div class="step-labels">
      <div class="step-lbl active" id="lbl1">Info</div>
      <div class="step-lbl" id="lbl2">Dates</div>
      <div class="step-lbl" id="lbl3">Submit</div>
    </div>
  </div>

  <!-- STEP 1 -->
  <div class="card active" id="step1">
    <div class="card-title">Who are you?</div>
    <div class="card-sub">Select your DJ name and the month you're submitting availability for.</div>

    <div class="field">
      <div class="field-label">DJ Name</div>
      <div class="custom-select" id="cs-dj">
        <div class="custom-select-trigger" onclick="toggleSelect('cs-dj')">
          <span class="placeholder" id="cs-dj-label">Select your name</span>
          <span class="arrow">
            <svg width="12" height="8" viewBox="0 0 12 8" fill="none"><path d="M1 1l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          </span>
        </div>
        <div class="custom-select-dropdown" id="cs-dj-drop">
          <div class="custom-option" style="color:#aaa">Loading...</div>
        </div>
      </div>
    </div>

    <div class="field">
      <div class="field-label">Month</div>
      <div class="custom-select" id="cs-mo">
        <div class="custom-select-trigger" onclick="toggleSelect('cs-mo')">
          <span class="placeholder" id="cs-mo-label">Select month</span>
          <span class="arrow">
            <svg width="12" height="8" viewBox="0 0 12 8" fill="none"><path d="M1 1l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          </span>
        </div>
        <div class="custom-select-dropdown" id="cs-mo-drop">
        </div>
      </div>
    </div>

    <button class="btn btn-primary" onclick="goStep2()">Next ‚Üí</button>
  </div>

  <!-- STEP 2 ‚Äî regular DJs -->
  <div class="card" id="step2">
    <div class="card-title" id="step2-title">Your availability</div>
    <div class="card-sub" id="step2-sub">Tap a date to open it, or use the quick options below.</div>

    <!-- Regular DJ: time slot picker -->
    <div id="regular-dj-ui">
      <div id="all-month-wrap" style="margin-bottom:14px;">
        <button class="btn-all-month" id="all-month-btn" onclick="toggleAllMonth()">
          <span style="font-size:18px;">üìÖ</span>
          <div>
            <div style="font-size:13px;font-weight:800;">Available All Month</div>
            <div style="font-size:10px;font-weight:500;opacity:0.75;">14:00 ‚Äì 02:00 every day ¬∑ tap again to clear</div>
          </div>
        </button>
      </div>
      <div id="cal"></div>
    </div>

    <!-- Resident: blackout day picker -->
    <div id="resident-ui" style="display:none;">
      <div style="background:rgba(241,90,41,0.12);border:1px solid rgba(241,90,41,0.3);border-radius:12px;padding:14px 16px;margin-bottom:16px;">
        <div style="font-size:12px;font-weight:800;color:#ff8a65;margin-bottom:4px;">Resident DJ ‚Äî Days Off</div>
        <div style="font-size:11px;color:rgba(255,255,255,0.5);font-weight:600;">You are available every day by default. Tap any days you are NOT available.</div>
      </div>
      <div id="blackout-cal"></div>
    </div>

    <div class="btn-row">
      <button class="btn btn-ghost" onclick="goStep1()">‚Üê Back</button>
      <button class="btn btn-primary" onclick="goStep3()">Review ‚Üí</button>
    </div>
  </div>

  <!-- STEP 3 -->
  <div class="card" id="step3">
    <div class="card-title">Review & Submit</div>
    <div class="card-sub">Check your availability below, then submit.</div>
    <div id="summary"></div>

    <div class="btn-row">
      <button class="btn btn-ghost" onclick="goStep2()">‚Üê Back</button>
      <button class="btn btn-submit" id="sub-btn" onclick="doSubmit()">‚úì Submit Availability</button>
    </div>
  </div>

  <!-- SUCCESS -->
  <div class="success" id="success">
    <div class="icon">üéß</div>
    <h2>All done!</h2>
    <p id="suc-msg"></p>
    <button class="reset-btn" onclick="resetAll()">‚Ü© Submit for another month</button>
  </div>

</div>

<script>
const SLOTS = ['14:00','15:00','16:00','17:00','18:00','19:00','20:00','21:00','22:00','23:00','00:00','01:00','02:00'];
const DS=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
const DF=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
const MN=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

const RESIDENTS = ['Alex RedWhite', 'Raffo DJ', 'Sound Bogie'];
let isResident = false;
let blackoutDates = new Set(); // dates resident marked as NOT available
let st={}, djName='', moKey='', moLabel='';
const selectVals = { 'cs-dj': '', 'cs-mo': '' };
const selectKeys = { 'cs-mo': {} };

// Load DJ list from Google Sheets
fetch('/api/djs')
  .then(r => r.json())
  .then(data => {
    const drop = document.getElementById('cs-dj-drop');
    drop.innerHTML = '';
    (data.djs || []).forEach(dj => {
      const div = document.createElement('div');
      div.className = 'custom-option';
      div.textContent = dj.name;
      div.onclick = () => selectOpt('cs-dj', dj.name);
      drop.appendChild(div);
    });
  })
  .catch(() => {
    document.getElementById('cs-dj-drop').innerHTML =
      '<div class="custom-option" style="color:#e53935">Failed to load DJs</div>';
  });

/* ‚îÄ‚îÄ CUSTOM SELECT ‚îÄ‚îÄ */
function toggleSelect(id) {
  const el = document.getElementById(id);
  const isOpen = el.classList.contains('open');
  // close all
  document.querySelectorAll('.custom-select.open').forEach(s => s.classList.remove('open'));
  if(!isOpen) el.classList.add('open');
}

function selectOpt(id, label, key) {
  const el    = document.getElementById(id);
  const lbl   = document.getElementById(id+'-label');
  lbl.textContent = label;
  lbl.className   = 'selected-val';
  selectVals[id]  = label;
  if(key) selectVals[id+'_key'] = key;
  // mark selected
  el.querySelectorAll('.custom-option').forEach(o => {
    o.classList.toggle('selected', o.textContent === label);
  });
  el.classList.remove('open');
}

// Close on outside click
document.addEventListener('click', e => {
  if(!e.target.closest('.custom-select')) {
    document.querySelectorAll('.custom-select.open').forEach(s => s.classList.remove('open'));
  }
});

/* ‚îÄ‚îÄ STEP NAV ‚îÄ‚îÄ */
function setStep(n) {
  [1,2,3].forEach(i => {
    document.getElementById('step'+i).classList.toggle('active', i===n);
    const d=document.getElementById('dot'+i), l=document.getElementById('lbl'+i);
    d.className='step-dot'+(i===n?' active':i<n?' done':'');
    l.className='step-lbl'+(i===n?' active':i<n?' done':'');
    if(i<3) document.getElementById('line'+i).className='step-line'+(i<n?' done':'');
  });
  window.scrollTo({top:0,behavior:'smooth'});
}

function goStep2() {
  djName  = selectVals['cs-dj'];
  moKey   = selectVals['cs-mo_key'];
  moLabel = selectVals['cs-mo'];
  if(!djName||!moKey){alert('Please select your DJ name and month.');return;}
  isResident = RESIDENTS.includes(djName);
  blackoutDates = new Set();

  if (isResident) {
    // Show resident blackout UI
    document.getElementById('regular-dj-ui').style.display = 'none';
    document.getElementById('resident-ui').style.display = '';
    document.getElementById('step2-title').textContent = 'Days you cannot work';
    document.getElementById('step2-sub').textContent = 'Tap any days you are NOT available. Leave blank if you are available all month.';
    buildBlackoutCal();
  } else {
    // Show regular availability UI
    document.getElementById('regular-dj-ui').style.display = '';
    document.getElementById('resident-ui').style.display = 'none';
    document.getElementById('step2-title').textContent = 'Your availability';
    document.getElementById('step2-sub').textContent = 'Tap a date to open it, or use the quick options below.';
    buildCal();
  }
  setStep(2);
}
function goStep3() { buildSummary(); setStep(3); }
function goStep1() { setStep(1); }

/* ‚îÄ‚îÄ BLACKOUT CALENDAR (residents) ‚îÄ‚îÄ */
function buildBlackoutCal() {
  const el = document.getElementById('blackout-cal');
  el.innerHTML = '';
  const [y, m] = moKey.split('-').map(Number);
  const mo = m - 1;
  const days = new Date(y, mo + 1, 0).getDate();
  const DAYS_SHORT = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  for (let d = 1; d <= days; d++) {
    const date = new Date(y, mo, d);
    const dow = date.getDay();
    const key = `${y}-${String(mo+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const dateLabel = `${d} ${MN[mo]} ${y}`;
    const isOff = blackoutDates.has(dateLabel);
    const card = document.createElement('div');
    card.id = 'bc-' + key;
    card.style.cssText = `
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 16px; margin-bottom:8px; border-radius:12px; cursor:pointer;
      border:1px solid ${isOff ? 'rgba(241,90,41,0.5)' : 'rgba(255,255,255,0.08)'};
      background:${isOff ? 'rgba(241,90,41,0.15)' : 'rgba(255,255,255,0.04)'};
      transition:all 0.15s;
    `;
    card.innerHTML = `
      <div style="display:flex;align-items:center;gap:12px;">
        <div style="font-size:10px;font-weight:800;color:${dow===0||dow===6?'var(--ark-orange)':'var(--teal)'};text-transform:uppercase;letter-spacing:0.08em;min-width:28px;">${DAYS_SHORT[dow]}</div>
        <div style="font-size:14px;font-weight:700;color:${isOff?'rgba(255,255,255,0.9)':'rgba(255,255,255,0.6)'};">${d} ${MN[mo]}</div>
      </div>
      <div style="font-size:11px;font-weight:800;color:${isOff?'#ff8a65':'rgba(255,255,255,0.2)'};">
        ${isOff ? '‚úï NOT AVAILABLE' : 'Available'}
      </div>`;
    card.onclick = () => toggleBlackout(key, dateLabel, mo, y);
    el.appendChild(card);
  }
}

function toggleBlackout(key, dateLabel, mo, y) {
  if (blackoutDates.has(dateLabel)) {
    blackoutDates.delete(dateLabel);
  } else {
    blackoutDates.add(dateLabel);
  }
  // Re-render just this card
  const d = parseInt(key.split('-')[2]);
  const date = new Date(+key.split('-')[0], mo, d);
  const dow = date.getDay();
  const DAYS_SHORT = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  const isOff = blackoutDates.has(dateLabel);
  const card = document.getElementById('bc-' + key);
  if (card) {
    card.style.borderColor = isOff ? 'rgba(241,90,41,0.5)' : 'rgba(255,255,255,0.08)';
    card.style.background = isOff ? 'rgba(241,90,41,0.15)' : 'rgba(255,255,255,0.04)';
    card.innerHTML = `
      <div style="display:flex;align-items:center;gap:12px;">
        <div style="font-size:10px;font-weight:800;color:${dow===0||dow===6?'var(--ark-orange)':'var(--teal)'};text-transform:uppercase;letter-spacing:0.08em;min-width:28px;">${DAYS_SHORT[dow]}</div>
        <div style="font-size:14px;font-weight:700;color:${isOff?'rgba(255,255,255,0.9)':'rgba(255,255,255,0.6)'};">${d} ${MN[mo]}</div>
      </div>
      <div style="font-size:11px;font-weight:800;color:${isOff?'#ff8a65':'rgba(255,255,255,0.2)'};">
        ${isOff ? '‚úï NOT AVAILABLE' : 'Available'}
      </div>`;
    card.onclick = () => toggleBlackout(key, dateLabel, mo, parseInt(key.split('-')[0]));
  }
}

/* ‚îÄ‚îÄ CALENDAR ‚îÄ‚îÄ */
function buildCal() {
  const el=document.getElementById('cal'); el.innerHTML='';
  const [y,m] = moKey.split('-').map(Number);
  const mo = m-1;
  const h=document.createElement('div'); h.className='cal-month-title'; h.textContent=moLabel; el.appendChild(h);
  const days=new Date(y,mo+1,0).getDate();
  for(let d=1;d<=days;d++){
    const date=new Date(y,mo,d), dow=date.getDay();
    const key=`${y}-${String(mo+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    if(!st[key]) st[key]=[];
    el.appendChild(makeDayCard(key,d,dow,mo));
  }
}

function makeDayCard(key,d,dow,m) {
  const card=document.createElement('div');
  card.className='day-card'; card.id='dc-'+key;
  card.innerHTML=`
    <div class="day-header" onclick="toggleDay('${key}')">
      <div class="day-dow">${DS[dow]}</div>
      <div class="day-date-txt">${d} ${MN[m]}</div>
      <button class="full-day-btn" id="fdb-${key}" onclick="toggleFullDay('${key}');event.stopPropagation()">‚ö° Full Day</button>
      <div class="day-badge" id="badge-${key}"></div>
      <div class="day-chevron">‚ñæ</div>
    </div>
    <div class="time-picker" id="tp-${key}">
      <div id="ranges-${key}"></div>
      <button class="add-range-btn" onclick="addRange('${key}');event.stopPropagation()">Ôºã Add another time range</button>
      <div class="day-note">Leave closed if not available this day</div>
    </div>`;
  return card;
}

function setFullDay(key) {
  // Clear existing ranges
  st[key] = [];
  document.getElementById('ranges-'+key).innerHTML = '';
  // Add full day range 14:00 - 02:00
  const idx = 0;
  st[key].push({start:'14:00', end:'02:00'});
  const wrap = document.createElement('div');
  wrap.className = 'range-block'; wrap.id = `rb-${key}-0`;
  wrap.innerHTML = `
    <div class="range-row">
      <div class="range-lbl">From</div>
      <select class="time-sel" id="s-${key}-0" onchange="onRC('${key}',0)"></select>
      <div class="range-arrow">‚Üí</div>
      <select class="time-sel" id="e-${key}-0" onchange="onRC('${key}',0)"></select>
      <div class="range-lbl">To</div>
    </div>
    <div class="slots-preview" id="pv-${key}-0"></div>`;
  document.getElementById('ranges-'+key).appendChild(wrap);
  populateTimeSelects(key, 0);
  // Force select values
  const s = document.getElementById(`s-${key}-0`);
  const e = document.getElementById(`e-${key}-0`);
  if(s) s.value = '14:00';
  rebuildEndOptions(key, 0);
  if(e) e.value = '02:00';
  st[key][0] = {start:'14:00', end:'02:00'};
  // Update preview chips
  const pv = document.getElementById(`pv-${key}-0`);
  if(pv){ pv.innerHTML=''; getSlots('14:00','02:00').forEach(slot=>{ const c=document.createElement('div'); c.className='slot-chip'; c.textContent=slot; pv.appendChild(c); }); }
  refreshBadge(key);
}

function clearDay(key) {
  st[key] = [];
  document.getElementById('ranges-'+key).innerHTML = '';
  refreshBadge(key);
}

function toggleFullDay(key) {
  const btn = document.getElementById(`fdb-${key}`);
  const card = document.getElementById(`dc-${key}`);
  const isFullDay = btn.classList.contains('active');
  if(isFullDay) {
    clearDay(key);
    btn.classList.remove('active');
    btn.textContent = '‚ö° Full Day';
    card.classList.remove('open');
  } else {
    setFullDay(key);
    btn.classList.add('active');
    btn.textContent = '‚úì Full Day';
    card.classList.remove('open'); // collapse after setting
  }
  // Sync all-month button state
  syncAllMonthBtn();
}

let allMonthActive = false;
function toggleAllMonth() {
  allMonthActive = !allMonthActive;
  const btn = document.getElementById('all-month-btn');
  // Get all day keys from current calendar
  const keys = Object.keys(st);
  if(allMonthActive) {
    btn.classList.add('active');
    btn.querySelector('div > div:first-child').textContent = '‚úì All Month Selected';
    btn.querySelector('div > div:last-child').textContent = 'Tap again to clear all';
    keys.forEach(k => setFullDay(k));
    // Mark all full-day buttons active
    keys.forEach(k => {
      const b = document.getElementById(`fdb-${k}`);
      if(b){ b.classList.add('active'); b.textContent='‚úì Full Day'; }
    });
  } else {
    btn.classList.remove('active');
    btn.querySelector('div > div:first-child').textContent = 'Available All Month';
    btn.querySelector('div > div:last-child').textContent = '14:00 ‚Äì 02:00 every day ¬∑ tap again to clear';
    keys.forEach(k => clearDay(k));
    keys.forEach(k => {
      const b = document.getElementById(`fdb-${k}`);
      if(b){ b.classList.remove('active'); b.textContent='‚ö° Full Day'; }
    });
  }
}

function syncAllMonthBtn() {
  const keys = Object.keys(st);
  const allFull = keys.length > 0 && keys.every(k => {
    const r = st[k][0];
    return r && r.start==='14:00' && r.end==='02:00' && st[k].filter(x=>x!==null).length===1;
  });
  const btn = document.getElementById('all-month-btn');
  if(!btn) return;
  if(allFull) {
    allMonthActive = true;
    btn.classList.add('active');
  } else {
    allMonthActive = false;
    btn.classList.remove('active');
  }
}


function toggleDay(key) {
  const c=document.getElementById('dc-'+key);
  c.classList.toggle('open');
  if(c.classList.contains('open')&&st[key].length===0) addRange(key);
}

function addRange(key) {
  const idx=st[key].length; st[key].push({start:'',end:''});
  const wrap=document.createElement('div');
  wrap.className='range-block'; wrap.id=`rb-${key}-${idx}`;
  wrap.innerHTML=`
    ${idx>0?`<button class="remove-btn" onclick="removeRange('${key}',${idx});event.stopPropagation()">‚úï</button>`:''}
    <div class="range-row">
      <div class="range-lbl">From</div>
      <select class="time-sel" id="s-${key}-${idx}" onchange="onRC('${key}',${idx})">
        <option value="">Start</option>
      </select>
      <div class="range-arrow">‚Üí</div>
      <select class="time-sel" id="e-${key}-${idx}" onchange="onRC('${key}',${idx})">
        <option value="">End</option>
      </select>
      <div class="range-lbl">To</div>
    </div>
    <div class="slots-preview" id="pv-${key}-${idx}"></div>`;
  document.getElementById('ranges-'+key).appendChild(wrap);
  populateTimeSelects(key, idx);
}

function getUsedSlots(key, excludeIdx) {
  const used = new Set();
  (st[key]||[]).forEach((r,i) => {
    if(i===excludeIdx || !r || !r.start || !r.end) return;
    getSlots(r.start, r.end).forEach(s => used.add(s));
  });
  return used;
}

function populateTimeSelects(key, idx) {
  const usedSlots = getUsedSlots(key, idx);
  const usedStartTimes = new Set();
  usedSlots.forEach(s => { usedStartTimes.add(s.split('‚Äì')[0]); usedStartTimes.add(s.split('‚Äì')[1]); });

  const startEl = document.getElementById(`s-${key}-${idx}`);
  const endEl   = document.getElementById(`e-${key}-${idx}`);
  if(!startEl || !endEl) return;

  const curStart = startEl.value;
  const curEnd   = endEl.value;

  startEl.innerHTML = '<option value="">Start</option>';
  SLOTS.forEach(t => {
    const blocked = [...usedSlots].some(s => {
      const [a,b] = s.split('‚Äì');
      const si=SLOTS.indexOf(a), ei=SLOTS.indexOf(b), ti=SLOTS.indexOf(t);
      return ti>=si && ti<ei;
    });
    const opt = document.createElement('option');
    opt.value = t; opt.textContent = t;
    if(blocked){ opt.disabled=true; opt.style.color='#ccc'; opt.textContent = t+' (taken)'; }
    if(t===curStart) opt.selected=true;
    startEl.appendChild(opt);
  });

  // Rebuild end options based on selected start
  rebuildEndOptions(key, idx);
}

function rebuildEndOptions(key, idx) {
  const startEl = document.getElementById(`s-${key}-${idx}`);
  const endEl   = document.getElementById(`e-${key}-${idx}`);
  if(!startEl || !endEl) return;

  const start = startEl.value;
  const curEnd = endEl.value;
  const usedSlots = getUsedSlots(key, idx);

  endEl.innerHTML = '<option value="">End</option>';
  if(!start) return;

  const startIdx = SLOTS.indexOf(start);
  for(let i=startIdx+1; i<SLOTS.length; i++){
    const t = SLOTS[i];
    // Check if any slot between start and this end would overlap
    let blocked = false;
    for(let j=startIdx; j<i; j++){
      const slotLabel = `${SLOTS[j]}‚Äì${SLOTS[j+1]}`;
      if(usedSlots.has(slotLabel)){ blocked=true; break; }
    }
    const opt = document.createElement('option');
    opt.value = t; opt.textContent = t;
    if(blocked){ opt.disabled=true; opt.style.color='#ccc'; opt.textContent = t+' (overlap)'; }
    if(t===curEnd) opt.selected=true;
    endEl.appendChild(opt);
    if(blocked) break; // stop offering options past first overlap
  }
}

function removeRange(key,idx) {
  st[key][idx]=null;
  const el=document.getElementById(`rb-${key}-${idx}`);
  if(el) el.remove();
  // Repopulate remaining ranges
  st[key].forEach((_,i) => { if(st[key][i]!==null) populateTimeSelects(key,i); });
  refreshBadge(key);
}

function onRC(key,idx) {
  const s=document.getElementById(`s-${key}-${idx}`)?.value||'';
  const e=document.getElementById(`e-${key}-${idx}`)?.value||'';
  if(st[key][idx]!==null) st[key][idx]={start:s,end:e};
  rebuildEndOptions(key,idx);
  const pv=document.getElementById(`pv-${key}-${idx}`);
  if(pv){ pv.innerHTML=''; getSlots(s,e).forEach(slot=>{ const c=document.createElement('div'); c.className='slot-chip'; c.textContent=slot; pv.appendChild(c); }); }
  // Update other ranges in same day
  st[key].forEach((_,i)=>{ if(i!==idx && st[key][i]!==null) populateTimeSelects(key,i); });
  refreshBadge(key);
}

function getSlots(s,e) {
  const si=SLOTS.indexOf(s),ei=SLOTS.indexOf(e);
  if(si<0||ei<0||si>=ei) return [];
  return Array.from({length:ei-si},(_,i)=>`${SLOTS[si+i]}‚Äì${SLOTS[si+i+1]}`);
}

function allSlotsForDay(key) {
  const res=[];
  (st[key]||[]).forEach(r=>{ if(r&&r.start&&r.end) getSlots(r.start,r.end).forEach(s=>{ if(!res.includes(s)) res.push(s); }); });
  return res;
}

function refreshBadge(key) {
  const slots=allSlotsForDay(key);
  document.getElementById('dc-'+key).classList.toggle('has-slots',slots.length>0);
  const b=document.getElementById('badge-'+key);
  if(b) b.textContent=slots.length?`${slots.length}h`:'';
}

/* ‚îÄ‚îÄ SUMMARY ‚îÄ‚îÄ */
function buildSummary() {
  const el=document.getElementById('summary'); el.innerHTML='';

  if (isResident) {
    // Resident summary: show days off
    const offDays = [...blackoutDates].sort();
    const offCount = offDays.length;
    el.innerHTML = `<div class="summary-header"><div><div class="s-dj">${djName}</div><div class="s-month">${moLabel}</div></div><div class="s-hours"><span class="num">${offCount}</span><span class="lbl">days off</span></div></div>`;
    if (offCount === 0) {
      el.innerHTML += '<p style="text-align:center;padding:20px;font-size:12px;font-weight:600;color:rgba(255,255,255,0.4)">No days off ‚Äî available all month ‚úì</p>';
      return;
    }
    offDays.forEach(dateLabel => {
      const parts = dateLabel.split(' ');
      const d = parseInt(parts[0]);
      const mo = MN.indexOf(parts[1]);
      const dow = new Date(parseInt(parts[2]), mo, d).getDay();
      const row = document.createElement('div'); row.className='summary-row';
      row.innerHTML = `<div class="s-date"><div class="s-dow">${DS[dow]}</div><div class="s-num">${d} ${MN[mo]}</div></div><div class="s-chips"><div class="s-chip" style="background:rgba(241,90,41,0.3);border:1px solid rgba(241,90,41,0.5);">NOT AVAILABLE</div></div>`;
      el.appendChild(row);
    });
    return;
  }

  // Regular DJ summary
  const entries=Object.keys(st).map(k=>({k,slots:allSlotsForDay(k)})).filter(e=>e.slots.length>0).sort((a,b)=>a.k.localeCompare(b.k));
  const total=entries.reduce((s,e)=>s+e.slots.length,0);
  el.innerHTML=`<div class="summary-header"><div><div class="s-dj">${djName}</div><div class="s-month">${moLabel}</div></div><div class="s-hours"><span class="num">${total}</span><span class="lbl">hours</span></div></div>`;
  if(!entries.length){el.innerHTML+='<p style="text-align:center;color:var(--text-light);padding:20px;font-size:12px;font-weight:600">No availability selected. Go back and mark your dates.</p>';return;}
  entries.forEach(({k,slots})=>{
    const [y,m,d]=k.split('-');
    const dow=new Date(+y,+m-1,+d).getDay();
    const row=document.createElement('div'); row.className='summary-row';
    row.innerHTML=`<div class="s-date"><div class="s-dow">${DS[dow]}</div><div class="s-num">${+d} ${MN[+m-1]}</div></div><div class="s-chips">${slots.map(s=>`<div class="s-chip">${s}</div>`).join('')}</div>`;
    el.appendChild(row);
  });
}

/* ‚îÄ‚îÄ SUBMIT ‚îÄ‚îÄ */
const WEBHOOK = 'https://hook.eu2.make.com/45cdesq5s9kk6dd68a6sy87ir8v5zhv4';
const MN_LONG=['January','February','March','April','May','June','July','August','September','October','November','December'];

// Build next 3 months dynamically
document.addEventListener('DOMContentLoaded', function buildMonthOptions(){
  const drop = document.getElementById('cs-mo-drop');
  const now = new Date();
  for(let i=1; i<=3; i++){
    const d = new Date(now.getFullYear(), now.getMonth()+i, 1);
    const y = d.getFullYear();
    const m = d.getMonth();
    const label = `${MN_LONG[m]} ${y}`;
    const key   = `${y}-${String(m+1).padStart(2,'0')}`;
    const opt = document.createElement('div');
    opt.className = 'custom-option';
    opt.textContent = label;
    opt.onclick = () => selectOpt('cs-mo', label, key);
    if(i>1) opt.style.borderTop = '1px solid var(--border-soft)';
    drop.appendChild(opt);
  }
});

async function doSubmit() {
  const btn=document.getElementById('sub-btn');
  btn.disabled=true; btn.textContent='Submitting...';

  if (isResident) {
    // Resident: POST blackout dates directly to our server
    const dates = [...blackoutDates];
    try {
      const res = await fetch('/api/blackout', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ dj: djName, month: moLabel, dates })
      });
      const data = await res.json();
      if (data.success) {
        showSuccess(dates.length, true);
      } else {
        btn.disabled=false; btn.textContent='‚úì Submit Availability';
        alert('Submission failed: ' + (data.error || 'Unknown error'));
      }
    } catch(e) {
      btn.disabled=false; btn.textContent='‚úì Submit Availability';
      alert('Connection error. Please try again.');
    }
    return;
  }

  // Regular DJ: send to Make webhook
  const entries=Object.keys(st).map(k=>({k,slots:allSlotsForDay(k)})).filter(e=>e.slots.length>0).sort((a,b)=>a.k.localeCompare(b.k));
  if(!entries.length){
    btn.disabled=false; btn.textContent='‚úì Submit Availability';
    alert('No availability selected. Please go back and mark your dates.');
    return;
  }
  const now=new Date().toISOString(), rows=[];
  entries.forEach(({k,slots})=>{
    const [y,m,d]=k.split('-');
    const dow=new Date(+y,+m-1,+d).getDay();
    const dateLabel=`${+d} ${MN[+m-1]} ${y}`;
    slots.forEach(slot=>rows.push({timestamp:now,dj:djName,month:moLabel,date:dateLabel,day:DF[dow],slot}));
  });
  const payload={dj:djName,month:moLabel,submitted_at:now,total_hours:rows.length,rows};
  try{ await fetch(WEBHOOK,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload),mode:'no-cors'}); }catch(e){}
  showSuccess(rows.length, false);
}

function showSuccess(count, isBlackout) {
  document.getElementById('step3').classList.remove('active');
  const s=document.getElementById('success'); s.classList.add('show');
  if (isBlackout) {
    const msg = count === 0
      ? `<strong>${djName}</strong> ‚Äî ${moLabel}<br>Submitted: available all month ‚úì`
      : `<strong>${djName}</strong> ‚Äî ${moLabel}<br>${count} day${count!==1?'s':''} off submitted ‚úì<br><br>You are available all other days this month.`;
    document.getElementById('suc-msg').innerHTML = msg;
  } else {
    document.getElementById('suc-msg').innerHTML=`<strong>${djName}</strong> ‚Äî ${moLabel}<br>${count} hour slot${count!==1?'s':''} submitted successfully ‚úì<br><br>The team will be in touch with your schedule.`;
  }
  window.scrollTo({top:0,behavior:'smooth'});
}

function resetAll() {
  allMonthActive = false;
  isResident = false;
  blackoutDates = new Set();
  st={}; djName=''; moKey=''; moLabel='';
  ['cs-dj','cs-mo'].forEach(id=>{
    selectVals[id]='';
    const lbl=document.getElementById(id+'-label');
    lbl.className='placeholder';
    lbl.textContent=id==='cs-dj'?'Select your name':'Select month';
    document.querySelectorAll(`#${id}-drop .custom-option`).forEach(o=>o.classList.remove('selected'));
  });
  document.getElementById('cal').innerHTML='';
  document.getElementById('blackout-cal').innerHTML='';
  document.getElementById('summary').innerHTML='';
  document.getElementById('success').classList.remove('show');
  const btn=document.getElementById('sub-btn'); btn.disabled=false; btn.textContent='‚úì Submit Availability';
  setStep(1);
}
</script>
</body>
</html>
